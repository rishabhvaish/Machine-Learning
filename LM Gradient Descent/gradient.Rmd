---
title: "LM using gradient descent"
author: "Rishabh Vaish"
output: 
  pdf_document: default
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(fig.height = 6, fig.width = 8, out.width = '50%', fig.align = "center")
options(width = 90)
```

## Linear Regression through Optimization

Linear regression is most popular statistical model, and the core technique for solving a linear regression is
simply inverting a matrix:
  
  $$\hat\beta = \left ( X^TX \right )^{-1}X^Ty$$
  
However, lets consider alternative approaches to solve linear regression through optimization. We use a
gradient descent approach. We know that $\hat\beta$ can also be expressed as
$$\hat\beta = arg min\ l(\beta) = argmin\ \frac{1}{2n} \sum_{i}^{2n}\left ( y_i - x_i^T\beta \right ) x_i$$
  
To perform the optimization, we will first set an initial beta value, say $\beta$ = 0 for all entries, then proceed
with the updating
$$ \beta^{new} = \beta^{old} + \frac{\partial l(\beta)}{\partial \beta} \times \delta$$
  
where $\delta$ is some small constant, say 0.1. We will keep updating the beta values by setting $\beta^{new}$ as the old value and calcuting a new one untill the difference between $\beta^{new}$ and $\beta^{old}$ is less than a prespecified threshold $\epsilon$, e.g., $\epsilon = 10^{-6}$. You should also set a maximum number of iterations to prevent excessively long runing time.

R function mylm_g(x, y, delta, epsilon, maxitr) to implement this optimization version of linear regression. The output of this function is a vector of the estimated beta value

Created a mylm_g function in R which takes (x, y, delta, epsilon, maxitr) as inputs in matrix form of following dimensions - 
x is [n,p]
y is [n,1]

The function implements gradient descent approach for optimisation and outputs the beta estimates in matrix of [1,p] 

```{r}
mylm_g <- function(x, y, delta, epsilon, maxitr){
  #beta matrix
  beta <- matrix(0,1,ncol(x))
  for(i in 1:maxitr){
    #gradient 
    gradient <- (-1/nrow(x))*colSums((y - beta%*%t(x))%*%x)
    #calculating new beta
    beta_new <- beta - gradient*delta
    #checking distance between new and old beta
    beta_dist <- dist(rbind(beta, beta_new))
    #checking for threshold
    if (beta_dist < epsilon){
      break
    }
    #updating the beta values
    beta <- beta_new
  }  
  return(beta)
}
```

### Data implementation

Testing this function on the Boston Housing data from the `mlbench` package. Documentation is provided [here](https://www.rdocumentation.org/packages/mlbench/versions/2.1-1/topics/BostonHousing) if you need a description of the data. We will remove `medv`, `town` and `tract` from the data and use `cmedv` as the outcome. We will use a scaled and centered version of the data for estimation. Please also note that in this case, you do not need the intercept term. And you should compare your result to the `lm()` function on the same data. Experiment on different `maxitr` values to obtain a good solution. However your function should not run more than a few seconds. 

```{r include = TRUE}
library(mlbench)
data(BostonHousing2)
X = BostonHousing2[, !(colnames(BostonHousing2) %in% c("medv", "town", "tract", "cmedv"))]
X = data.matrix(X)
X = scale(X)
Y = as.vector(scale(BostonHousing2$cmedv))
```

Estimating beta using the function created above and comparing it with the beta values generated by using lm function. The values are similar. The difference between the 2 beta estimates is shown

```{r}
# Setting the parameters
delta = 0.1
epsilon = 10^-7
maxitr = 5000

#Estimating beta using the function
beta <- mylm_g(X,Y,delta,epsilon,maxitr)

#creating dataframe and fitting lm
df <- data.frame(cbind(X,Y))
linear_model = lm(Y ~ lon+lat+crim+zn+indus+chas+nox+rm+age+dis+rad+tax+ptratio+b+lstat, data = df)
beta_lm <- matrix(linear_model$coefficients[2:length(linear_model$coefficients)], 1, ncol(X))

#comparing the 2 beta values
beta_compare <- cbind(t(beta),t(beta_lm),t(abs(beta-beta_lm)))
colnames(beta_compare) <- c("Beta", "Beta_LM", "Error")
beta_compare

```